#version 300 es
#ifdef GL_ES
precision mediump float;
#endif

uniform vec2 u_resolution;
uniform vec2 u_mouse;
uniform float u_time;
out vec4 fragColor;

const int p[512] = int[512](
  151,160,137,91 ,90 ,15 ,131,13 ,201,95 ,96 ,53 ,194,233,7  ,225,
  140,36 ,103,30 ,69 ,142,8  ,99 ,37 ,240,21 ,10 ,23 ,190,6  ,148,
  247,120,234,75 ,0  ,26 ,197,62 ,94 ,252,219,203,117,35 ,11 ,32 ,
  57 ,177,33 ,88 ,237,149,56 ,87 ,174,20 ,125,136,171,168,68 ,175,
  74 ,165,71 ,134,139,48 ,27 ,166,77 ,146,158,231,83 ,111,229,122,
  60 ,211,133,230,220,105,92 ,41 ,55 ,46 ,245,40 ,244,102,143,54 ,
  65 ,25 ,63 ,161,1  ,216,80 ,73 ,209,76 ,132,187,208,89 ,18 ,169,
  200,196,135,130,116,188,159,86 ,164,100,109,198,173,186,3  ,64 ,
  52 ,217,226,250,124,123,5  ,202,38 ,147,118,126,255,82 ,85 ,212,
  207,206,59 ,227,47 ,16 ,58 ,17 ,182,189,28 ,42 ,223,183,170,213,
  119,248,152,2  ,44 ,154,163,70 ,221,153,101,155,167,43 ,172,9  ,
  129,22 ,39 ,253,19 ,98 ,108,110,79 ,113,224,232,178,185,112,104,
  218,246,97 ,228,251,34 ,242,193,238,210,144,12 ,191,179,162,241,
  81 ,51 ,145,235,249,14 ,239,107,49 ,192,214,31 ,181,199,106,157,
  184,84 ,204,176,115,121,50 ,45 ,127,4  ,150,254,138,236,205,93 ,
  222,114,67 ,29 ,24 ,72 ,243,141,128,195,78 ,66 ,215,61 ,156,180,

  151,160,137,91 ,90 ,15 ,131,13 ,201,95 ,96 ,53 ,194,233,7  ,225,
  140,36 ,103,30 ,69 ,142,8  ,99 ,37 ,240,21 ,10 ,23 ,190,6  ,148,
  247,120,234,75 ,0  ,26 ,197,62 ,94 ,252,219,203,117,35 ,11 ,32 ,
  57 ,177,33 ,88 ,237,149,56 ,87 ,174,20 ,125,136,171,168,68 ,175,
  74 ,165,71 ,134,139,48 ,27 ,166,77 ,146,158,231,83 ,111,229,122,
  60 ,211,133,230,220,105,92 ,41 ,55 ,46 ,245,40 ,244,102,143,54 ,
  65 ,25 ,63 ,161,1  ,216,80 ,73 ,209,76 ,132,187,208,89 ,18 ,169,
  200,196,135,130,116,188,159,86 ,164,100,109,198,173,186,3  ,64 ,
  52 ,217,226,250,124,123,5  ,202,38 ,147,118,126,255,82 ,85 ,212,
  207,206,59 ,227,47 ,16 ,58 ,17 ,182,189,28 ,42 ,223,183,170,213,
  119,248,152,2  ,44 ,154,163,70 ,221,153,101,155,167,43 ,172,9  ,
  129,22 ,39 ,253,19 ,98 ,108,110,79 ,113,224,232,178,185,112,104,
  218,246,97 ,228,251,34 ,242,193,238,210,144,12 ,191,179,162,241,
  81 ,51 ,145,235,249,14 ,239,107,49 ,192,214,31 ,181,199,106,157,
  184,84 ,204,176,115,121,50 ,45 ,127,4  ,150,254,138,236,205,93 ,
  222,114,67 ,29 ,24 ,72 ,243,141,128,195,78 ,66 ,215,61 ,156,180
);

float fade(float x) {
  return x * x * x * (x * (x * 6. - 15.) + 10.);
}

float grad3(int hash, float x, float y, float z) {
  switch (hash & 15) {
    case  0: return  x + y;
    case  1: return -x + y;
    case  2: return  x - y;
    case  3: return -x - y;
    case  4: return  x + z;
    case  5: return -x + z;
    case  6: return  x - z;
    case  7: return -x - z;
    case  8: return  y + z;
    case  9: return -y + z;
    case 10: return  y - z;
    case 11: return -y - z;
    case 12: return  y + x;
    case 13: return -y + z;
    case 14: return  y - x;
    case 15: return -y - z;
  }
  return 0.;
}

float grad2(int hash, float x, float y) {
  switch (hash & 3) {
    case  0: return  x + y;
    case  1: return -x + y;
    case  2: return  x - y;
    case  3: return -x - y;
  }
  return 0.;
}

float perlin3(vec3 a) {
  int xi = int(a.x) & 255;
  int yi = int(a.y) & 255;
  int zi = int(a.z) & 255;
  vec3 f = a - floor(a);
  float u = fade(f.x);
  float v = fade(f.y);
  float w = fade(f.z);
  return mix(mix(mix(grad3(p[p[p[xi  ]+yi  ]+zi  ], f.x   , f.y   , f.z   ),
                     grad3(p[p[p[xi+1]+yi  ]+zi  ], f.x-1., f.y   , f.z   ), u),
                 mix(grad3(p[p[p[xi  ]+yi+1]+zi  ], f.x   , f.y-1., f.z   ),
                     grad3(p[p[p[xi+1]+yi+1]+zi  ], f.x-1., f.y-1., f.z   ), u), v),
             mix(mix(grad3(p[p[p[xi  ]+yi  ]+zi+1], f.x   , f.y   , f.z-1.),
                     grad3(p[p[p[xi+1]+yi  ]+zi+1], f.x-1., f.y   , f.z-1.), u),
                 mix(grad3(p[p[p[xi  ]+yi+1]+zi+1], f.x   , f.y-1., f.z-1.),
                     grad3(p[p[p[xi+1]+yi+1]+zi+1], f.x-1., f.y-1., f.z-1.), u), v), w) * 0.5 + 0.5;
}

float perlin2(vec2 a) {
  int xi = int(a.x) & 255;
  int yi = int(a.y) & 255;
  vec2 f = a - floor(a);
  float u = fade(f.x);
  float v = fade(f.y);
  return mix(mix(grad2(p[p[xi  ]+yi  ], f.x   , f.y   ),
                 grad2(p[p[xi+1]+yi  ], f.x-1., f.y   ), u),
             mix(grad2(p[p[xi  ]+yi+1], f.x   , f.y-1.),
                 grad2(p[p[xi+1]+yi+1], f.x-1., f.y-1.), u), v) * 0.5 + 0.5;
}

void main() {
  vec2 pos = gl_FragCoord.xy / u_resolution.xy;
  /*fragColor = vec4(vec3(perlin3(vec3(pos*20., 0.)),
                        perlin3(vec3(pos*20., 0.)+vec3(80.)),
                        perlin3(vec3(pos*20., 0.)+vec3(160.))), 1.);*/
  /*fragColor = vec4(perlin2(pos*20.),
                   perlin2(pos*20.+vec2(80.)),
                   perlin2(pos*20.+vec2(160.)), 1.);*/
  fragColor = vec4(0., 0., 1., 1.);
}
